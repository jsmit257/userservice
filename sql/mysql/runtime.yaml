---

units:
  address:
    select-all: <<-
      select  uuid,
              street1,
              street2,
              city,
              state,
              country,
              zip,
              mtime,
              ctime,
              dtime
        from  addresses
    select: <<-
      select  uuid,
              street1,
              street2,
              city,
              state,
              country,
              zip,
              mtime,
              ctime,
              dtime
        from  addresses
       where  uuid = ?
    insert: <<-
      insert  
        into  addresses(
              uuid, 
              street1, 
              street2, 
              city, 
              state, 
              country, 
              zip, 
              mtime, 
              ctime)
      values  (?, ?, ?, ?, ?, ?, ?, ?, ?)
    update: <<-
      update  addresses
         set  street1 = ?,
              street2 = ?,
              city = ?,
              state = ?,
              country = ?,
              zip = ?,
              mtime = ?
       where  uuid = ?
    delete: update addresses set dtime = ? where uuid = ?

  basic-auth:
    select: <<-
      select  id,
              password,
              salt,
              loginsuccess,
              loginfailure,
              failurecount
        from  users
       where  uuid = ?
    update: <<-
      update  users
         set  password = ?,
              salt = ?,
              loginsuccess = ?,
              loginfailure = ?,
              failurecount = ?,
              mtime = current_timestamp
       where  uuid = ?

  contact:
    # select-all:
    # select:
    insert: <<-
      insert 
        into  contacts(
              uuid, 
              firstname, 
              lastname, 
              billto_uuid, 
              shipto_uuid, 
              mtime, 
              ctime)
      values  (?, ?, ?, ?, ?, ?, ?)
    update: <<-
      update  contacts
         set  uuid = ?, 
              firstname = ?, 
              lastname = ?, 
              billto_uuid = ?
              shipto_uuid = ?
              mtime = ?
       where  uuid = ?
    delete: update contact set dtime = ? where uuid = ?

  user:
    select-all: <<-
      select  id,
              name,
              mtime,
              ctime,
              dtime,
              loginsuccess,
              loginfailure,
              failurecount
        from  users
    select: <<-
      select  u.id,
              u.name,
              u.mtime,
              u.ctime,
              u.dtime,
              c.uuid as contact_uuid,
              c.firstname,
              c.lastname,
              c.billto_uuid,
              c.shipto_uuid,
              c.mtime as contact_mtime,
              c.ctime as contact_ctime,
              c.dtime as contact_dtime
        from  users u
        left
        join  contacts c
          on  u.uuid = c.user_uuid
       where  uuid = ?
    insert: <<-
      insert
        into  users(uuid, name, password, salt, mtime, ctime)
      values  (?, ?, ?, ?, ?, ?)
    update: <<-
      update  users
         set  name = ?,
              mtime = ?
       where  uuid = ?
    delete: update users set dtime = ? where uuid = ?